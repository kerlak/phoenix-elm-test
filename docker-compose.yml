version: '2'
services:
  postgres:
    image: postgres
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
    ports:
      - 5432:5432
  phoenix:
    image: kerlak/debian-phoenix-elm
    links:
      - postgres
    environment:
      - DATABASE_HOST=postgres
    ports:
      - 4000:4000
    volumes:
      - ./:/code
    # ONline use:
    entrypoint: /bin/bash -c "set -e -x && cd /code && mkdir -p priv/repo/migrations && yes | mix local.rebar --force && yes | mix deps.get && mix ecto.create && mix ecto.migrate && yes | npm install && mix phoenix.server"
    # OFFline use:
    # entrypoint: /bin/bash -c "set -e -x && cd /code && mkdir -p priv/repo/migrations && mix phoenix.server"
